<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titulo%></title>
    <link href="/game.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Marhey&family=Montserrat&family=Noto+Serif+Georgian&family=Pacifico&family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
    <div id="tela">

    </div>
</body>
<script>
    let text = '<%= game %>'
    text = text.split('&#34;')
    text = text.join('"')
    const game = JSON.parse(text)
    var pontuacao = 0
    var contagem_de_arrays = 0
    var tela = document.getElementById('tela')
    var criador = '<%= username %>'
            
    function criar_jogo(){
        contagem_de_arrays = 0
        document.body.style.backgroundColor = game.paleta[0]
        tela.style.fontFamily = game.fonte
        tela.style.color = game.paleta[5]
        pontuacao = 0
        botoes()
    }

    function botoes(){
        let tela = document.getElementById('tela')
        let ordenado =  game.perguntas[contagem_de_arrays].slice(1,)
        
        ordenado.sort()
        tela.innerHTML = `<p id='pergunta'> ${game.perguntas[contagem_de_arrays][0]} </p> <div id="botoes_tela"><div>`
        var botoes_tela = document.getElementById('botoes_tela')
        for(let c = 0; c < ordenado.length; c++){
            if(game.perguntas[contagem_de_arrays][1] === ordenado[c]){
                botoes_tela.innerHTML += `<button class='button_tela' style='color: ${game.paleta[5]}; background: ${game.paleta[3]}; font-family:${game.fonte};' onclick='resposta("certo")'>${ordenado[c]}</button><br>`
            } else {
                botoes_tela.innerHTML += `<button class='button_tela' style='color: ${game.paleta[5]}; background: ${game.paleta[3]}; font-family:${game.fonte};' onclick='resposta("errado")'>${ordenado[c]}</button><br>`
            }
        }
        tela.innerHTML += `<br> Criado por ${criador}`
        if(game.imagem == 'false'){
            document.getElementById('botoes_tela').style.textAlign = 'center'
        } else {
            document.getElementById('botoes_tela').style.paddingLeft = '150px'
        }
        
        contagem_de_arrays += 1
        var botoes = document.getElementById('tela').querySelectorAll('button')

        for(botao in botoes){
            if(!isNaN(Number.parseInt(botao))){
                botoes[botao].style.fontFamily = game.fonte
            }
        }

        let els = document.getElementsByClassName('button_tela')
        for(i in els){
            if(!isNaN(Number.parseInt(i))){
                els[i].addEventListener('mouseover', (e) => {
                    e.currentTarget.style.background = game.paleta[4]
                })
                els[i].addEventListener('mouseout', (e) => {
                    e.currentTarget.style.background = game.paleta[3]
                })
            }
        }
    }

    function resposta(classe){
        if(classe === 'certo'){
            tela.innerHTML = `<h1 style='color: ${game.paleta[2]};'>Acertou</h1>`
            pontuacao++
        } else {
            tela.innerHTML = `<h1 style='color: ${game.paleta[1]};'>Errou</h1>`
        }
        setTimeout(() => {
            if(contagem_de_arrays ===  game.perguntas.length){
                tela.innerHTML = `<p>O jogo acabou<br>Sua pontuação: ${pontuacao}/${ game.perguntas.length}</p>
                <br>
                <button id="Jogar_novamente" onclick="criar_jogo()" style="background: ${game.paleta[3]}; color: ${game.paleta[5]};">Jogar de novo</button>`

                let el = document.getElementById('Jogar_novamente')
                el.addEventListener('mouseover', (e) => {
                    e.currentTarget.style.background = game.paleta[4]
                })
                el.addEventListener('mouseout', (e) => {
                    e.currentTarget.style.background = game.paleta[3]
                })
            } else {
                botoes()
            }
        }, 1500);
    }

    criar_jogo()
</script>
</html>